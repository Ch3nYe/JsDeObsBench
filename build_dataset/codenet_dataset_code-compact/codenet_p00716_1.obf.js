function F1(m,b,c){var sum=0x0;for(var i=0x0;i<Y;i++){sum+=Math['floor'](m*b);m-=c;}return m+sum;}function F2(m,b,c){for(var i=0x0;i<Y;i++){m+=Math['floor'](m*b)-c;}return m;}var input=require('fs')['readFileSync']('/dev/stdin','utf8');var Arr=input['trim']()['split']('\x0a');var M=Arr['shift']()-0x0;for(var i=0x0;i<M;i++){var money=Arr['shift']()-0x0;var Y=Arr['shift']()-0x0;var N=Arr['shift']()-0x0;var arr=[];for(var j=0x0;j<N;j++){var D=Arr['shift']()['split']('\x20')['map'](Number);if(D[0x0]==0x0)arr['push'](F1(money,D[0x1],D[0x2]));if(D[0x0]==0x1)arr['push'](F2(money,D[0x1],D[0x2]));}console['log'](Math['max']['apply'](null,arr));}