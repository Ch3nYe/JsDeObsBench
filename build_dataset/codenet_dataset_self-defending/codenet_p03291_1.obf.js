var a0_0x5296f2=(function(){var firstCall=!![];return function(context,fn){var rfn=firstCall?function(){if(fn){var res=fn['apply'](context,arguments);fn=null;return res;}}:function(){};firstCall=![];return rfn;};}());var a0_0x538c81=a0_0x5296f2(this,function(){return a0_0x538c81['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](a0_0x538c81)['search']('(((.+)+)+)+$');});a0_0x538c81();var line;var S;var MOD=Math['pow'](0xa,0x9)+0x7;var readline=require('readline');var rl=readline['createInterface']({'input':process['stdin'],'output':process['stdout']});rl['on']('line',function(x){line=x;});rl['on']('close',function(){S=line['split']('');dp=Array(S['length']+0x1);for(var i=0x0;i<=S['length'];i++){dp[i]=Array(0x3+0x1)['fill'](0x0);}for(var i=S['length'];i>=0x0;i--){for(var j=0x3;j>=0x0;j--){if(i===S['length']){dp[i][j]=j===0x3?0x1:0x0;}else{dp[i][j]=dp[i+0x1][j]*(S[i]==='?'?0x3:0x1);if(j<0x3&&(S[i]==='?'||S[i]==='ABC'[j])){dp[i][j]+=dp[i+0x1][j+0x1];}dp[i][j]%=MOD;}}}console['log'](dp[0x0][0x0]);});